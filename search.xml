<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[第2篇：原始数据的质控、比对和过滤]]></title>
    <url>%2F2019%2F08%2F23%2F%E7%AC%AC2%E7%AF%87%EF%BC%9A%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%E7%9A%84%E8%B4%A8%E6%8E%A7%E3%80%81%E6%AF%94%E5%AF%B9%E5%92%8C%E8%BF%87%E6%BB%A4%2F</url>
    <content type="text"><![CDATA[这部分内容包括对原始测序数据质控，然后比对过滤，这是所有NGS数据处理的上游分析。 ATAC-Seq与其他方法不同的一点是需要过滤去除线粒体（如果是植物，还需要过滤叶绿体），因为线粒体DNA是裸露的，也可以被Tn5酶识别切割。 另外一点需要注意的是课程中给出的是单端比对的示例代码，如果是双端测序做相应更改即可。 学习目标 用FastQC进行质控检测 用Trimmomatic进行质量过滤 用Bowtie2比对，并理解相关参数含义测序reads 的质控流程示意图 FASTQC首先对拿到的原始测序数据（fastq或fastq.gz格式）进行质控检测，直接用fastqc软件，再加上multiqc将多个检测结果一起展示。如:12fastqc -o out_dir raw_data/*gzmultiqc *fastqc.zip --ignore *.html TrimmomaticTrimmomatic 可以用于去除接头，过滤低质量数据。相同功能的软件还有很多，如trim_galore、cutadapt等，个人比较喜欢trim_galore可以自动识别接头类型。123456789# 课程中给出的Trimmomatic 的用法（单端测序）$ java -jar /opt/Trimmomatic-0.33/trimmomatic-0.33.jar SE \-threads 2 \-phred33 \H1hesc_Input_Rep1_chr12.fastq \../results/trimmed/H1hesc_Input_Rep1_chr12.qualtrim20.minlen36.fq \LEADING:20 \TRAILING:20 \MINLEN:36 Trimmomatic参数含义：可以参考NGS 数据过滤之 Trimmomatic 详细说明trim_galore使用示例 1trim_galore -q 20 --phred33 --stringency 3 --length 20 -e 0.1 --paired fq1 fq2 --gzip -o input_data_dir 123# 重新用fastqc检测进行过滤后的reads质量fastqc -o out_dir *fq.gzmultiqc *fastqc.zip --ignore *.html 比对Bowtie2是一个快速精确的比对工具，基于Burrows-Wheeler Transform 构建基因组的FM 索引，比对过程所耗内存少。Bowtie2支持局部、双端、缺口比对模式，对大于50bp的reads比对效果更好（小于50bp的reads用Bowtie1）。 创建Bowtie2索引12bowtie2-build &lt;path_to_reference_genome.fa&gt; &lt;prefix_to_name_indexes&gt;# Can find indexes for the entire genome on Orchestra using following path: /groups/shared_databases/igenome/Homo_sapiens/UCSC/hg19/Sequence/Bowtie2Index/ Bowtie2 比对 p: 线程数 q: reads是fastq格式 x: index路径 U: fastq路径 S: 输出Sam格式文件12345## 课程中给出的代码是单端比对bowtie2 -p 2 -q \-x ~/ngs_course/chipseq/reference_data/chr12\-U ~/ngs_course/chipseq/results/trimmed/H1hesc_Input_Rep1_chr12.qualtrim20.minlen36.fq \-S ~/ngs_course/chipseq/results/bowtie2/H1hesc_Input_Rep1_chr12_aln_unsorted.sam NOTE: 如果fastq文件是没有经过trim的，可以用局部比对执行soft-clipping，加上参数--local 过滤reads首先将sam文件转为bam格式，再对bam文件进行排序，接着过滤唯一比对的reads，去除线粒体reads。转化为bam格式使用samtools转换格式123samtools view -h -S -b \-o H1hesc_Input_Rep1_chr12_aln_unsorted.bam \H1hesc_Input_Rep1_chr12_aln_unsorted.sam 对bam文件排序对bam文件按照基因组坐标排序，可以直接使用samtools，也可以使用Sambamba。sambamba快速处理bam和sam文件。 123sambamba sort -t 2 \-o H1hesc_Input_Rep1_chr12_aln_sorted.bam \H1hesc_Input_Rep1_chr12_aln_unsorted.bam 过滤唯一比对的reads 123sambamba view -h -t 2 -f bam \-F "[XS] == null and not unmapped " \H1hesc_Input_Rep1_chr12_aln_sorted.bam &gt; H1hesc_Input_Rep1_chr12_aln.bam 去除PCR重复PCR扩增和一些重复序列（如微卫星、着丝粒）会产生重复，干扰真实的富集信号，所以在call peaks前需要先去除重复，这里先用picard去除PCR重复。picard去除PCR重复时要加上参数REMOVE_DUPLICATES=true,否则只是标记了duplicates，并没有去除。 1java -jar picard-tools-1.119/MarkDuplicates.jar REMOVE_DUPLICATES=true I=H1hesc_Input_Rep1_chr12_aln.bam O=H1hesc_Input_Rep1_chr12_aln.dedup.bam M=H1hesc.duplicates.log 过滤线粒体reads 123samtools index H1hesc_Input_Rep1_chr12_aln.dedup.bamsamtools idxstats H1hesc_Input_Rep1_chr12_aln.dedup.bam &gt; H1hesc_Input_Rep1_chr12_aln.dedup.mitochondrial.statssamtools view -h H1hesc_Input_Rep1_chr12_aln.dedup.bam | grep -v 'chrM' | samtools view -bS -o H1hesc.final.bam 上面给出的仅是示例代码，和参考课程不一样，实际运行需要修改相应文件。此时就得到了唯一比对且已经去除过线粒体的比对文件，可以用于接下来的peaks calling。 参考资料：HBC的深度NGS数据分析课程：https://github.com/hbctraining/In-depth-NGS-Data-Analysis-Course/blob/master/sessionV/lessons/02_QC_and_alignment.md]]></content>
      <categories>
        <category>组学</category>
        <category>表观组</category>
      </categories>
      <tags>
        <tag>ATACseq</tag>
        <tag>QC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[第1篇：ATAC-seq的背景介绍以及与ChIP-Seq的异同]]></title>
    <url>%2F2019%2F08%2F23%2F%E7%AC%AC1%E7%AF%87%EF%BC%9AATAC-seq%E7%9A%84%E8%83%8C%E6%99%AF%E4%BB%8B%E7%BB%8D%E4%BB%A5%E5%8F%8A%E4%B8%8EChIP-Seq%E7%9A%84%E5%BC%82%E5%90%8C%2F</url>
    <content type="text"><![CDATA[ATAC-Seq简介ATAC-seq（Assay for Transposase-Accessible Chromatin with high throughput sequencing） 是2013年由斯坦福大学William J. Greenleaf和Howard Y. Chang实验室开发的用于研究染色质可及性（通常也理解为染色质的开放性）的方法， 原理是通过转座酶Tn5容易结合在开放染色质的特性，然后对Tn5酶捕获到的DNA序列进行测序。 真核生物的核DNA并不是裸露的，而是与组蛋白结合形成染色体的基本结构单位核小体，核小体再经逐步的压缩折叠最终形成染色体高级结构（如人的DNA链完整展开约2m长，经过这样的折叠就变成了纳米级至微米级的染色质结构而可以储存在小小的细胞核）。而DNA的复制转录是需要将DNA的紧密结构打开，从而允许一些调控因子结合（转录因子或其他调控因子）。这部分打开的染色质，就叫开放染色质，打开的染色质允许其他调控因子结合的特性称为染色质的可及性（chromatin accessibility）。因此，认为染色质的可及性与转录调控密切相关。开放染色质的研究方法有ATAC-seq以及传统的DNase-Seq及FAIRE-seq等，ATAC-Seq由于所需细胞量少，实验简单，可以在全基因组范围内检测染色质的开放状态，目前已经成为研究染色质开放性的首选技术方法。 Nat Methods, 2013. doi: 10.1038/nmeth.2688. Epub 2013 Oct. ATAC-Seq与ChIP-Seq的异同ATAC-Seq与ChIP-Seq的不同的是ATAC-Seq是全基因组范围内检测染色质的开放程度，可以得到全基因组范围内的蛋白质可能结合的位点信息，一般用于不知道特定的转录因子，用此方法与其他方法结合筛查感兴趣的特定调控因子；但是ChIP-Seq是明确知道感兴趣的转录因子是什么，根据感兴趣的转录因子设计抗体去做ChIP实验拉DNA，验证感兴趣的转录因子是否与DNA存在相互作用。ATAC-Seq、ChIP-Seq、Dnase-Seq、MNase-Seq、FAIRE-Seq整体的分析思路一致，找到富集区域，对富集区域进行功能分析。 ChIP-Seq是揭示特定转录因子或蛋白复合物的结合区域，实际是研究DNA和蛋白质的相互作用，利用抗体将蛋白质和DNA一起富集，并对富集到的DNA进行测序。 DNase-Seq、ATAC-Seq、FAIRE-Seq都是用来研究开放染色质区域。DNase-Seq是用的DNase I内切酶识别开放染色质区域，而ATAC-seq是用的Tn5转座酶，随后进行富集和扩增；FAIRE-Seq是先进行超声裂解，然后用酚-氯仿富集。 MNase-Seq是用来鉴定核小体区域。 翻译部分下面这一部分是对HBC课程中ChIP-Seq Introduction这一节的介绍，主要包括的ChIP-Seq的实验设计和分析方法总体思路。原文链接：https://github.com/hbctraining/In-depth-NGS-Data-Analysis-Course/blob/master/sessionV/lessons/01_Intro_chipseq_and_setup.md。 ChIP-Seq Introduction学习目标 理解ChIP-Seq的实验设计ChIP-Seq简介ChIP实验（Chromatin immunoprecipitation）即染色质免疫沉淀，根据DNA与蛋白质相互作用的原理，分离富集与感兴趣的蛋白相互作用的DNA。ChIP-Seq即对分离得到的DNA扩增测序，然后通过分析得到DNA的富集区域也称为peaks，同时可以鉴定过表达的序列motif以及进行功能注释分析。 下面这一部分将会介绍ChIP-Seq数据分析的整个流程，从实验设计到产生原始的测序reads，以及到最后的功能富集分析和motif查找。 实验设计和文库构建文库构建包括以下5步骤： 蛋白质与DNA的交联 超声打断DNA链 加附有抗体的磁珠用于免疫沉淀 解交联，纯化DNA DNA片段大小选择和PCR扩增 富集到的DNA片段只有一部分是真实的信号（感兴趣的蛋白结合的DNA区域），这个比例取决于number of active binding sites, the number of starting genomes, and the efficiency of the IP. ChIP-Seq富集序列存在以下特点： 开放染色质区域比紧密区域更易打断； 重复序列会出现似乎被富集的现象 序列在整个基因组上不均匀分布 因此，ChIP-Seq需要有合适的对照组，对照样本需要满足以下其中一个条件： 没有IP（input DAN） 没有抗体 (“mock IP”) 没有特定的抗体 (IgG “mock IP”) 示例数据介绍所用到的示例数据是来自于人类胚胎干细胞系（h1-ESC）中Nanog和Pou5f1（Oct4）两个转录因子的结合图谱。这两个转录因子的功能涉及干细胞的多能性，该研究的目标之一是探究这两个转录因子在转录调控中单独和相互的调控作用。两组重复，每组重复包括3个实验样本信息，共6个样本，数据分析中只用到了12号染色体的信息。Nanog IPPou5f1 IPControl input DNA 分析流程下面这幅图给出了整个分析流程，和每一步需要的数据格式，后面会展开介绍。 分析环境配置这个课程提供了示例数据和分析代码，可以参考这里连接他们的服务器，我没有连接成功，不知道是不是打开方式不对，大家可以尝试下，如果连接成功，这一部分就是配置服务器的环境，准备数据；如果也连接不上可以用自己的数据或者下载公共数据。 参考资料：ATAC-seq：染色质开放性测序技术Clifford A. et al. Nature review, 2014HBC课程V : 01-Introduction to ChIP-Seq]]></content>
      <categories>
        <category>组学</category>
        <category>表观组</category>
      </categories>
      <tags>
        <tag>ATACseq</tag>
      </tags>
  </entry>
</search>
