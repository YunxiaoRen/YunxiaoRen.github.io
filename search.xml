<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[01-scRNA-seq基础知识扫盲篇]]></title>
    <url>%2F2019%2F08%2F24%2FscRNA-seq%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%89%AB%E7%9B%B2%E7%AF%87%2F</url>
    <content type="text"><![CDATA[Bulk RNA-seq与scRNA-seq的优势和局限性Bulk RNA-seq 20世纪末即芯片技术后的又一个突破性技术，之后被广泛应用，逐渐替代芯片 评估测量一个大群体内所有细胞的平均表达量水平 适用于比较转录组学，如不同物种相同组织的不同样本间的转录表达差异比较；或者用于评估疾病等表达量特征 不适用于研究系统的异质性，如早期胚胎发育、复杂组织（脑） 不能提供基因表达量的随机特征 scRNA-seq 2009年出现 (Tang et al. 2009) 伴随着新的protocols和测序成本的降低，2014年左右被广泛推广 适用于检测一群细胞的表达量分布水平；细胞特异性变化等（如鉴定细胞类型、细胞应激的异质性，基因表达的随机性、推测细胞间的基因调控网络 数据集从102～ 10 8细胞，且逐年增长 目前的使用的protocols：SMART-seq2 (Picelli et al. 2013), CELL-seq (Hashimshony et al. 2012) and Drop-seq (Macosko et al. 2015) 商业平台：Fluidigm C1, Wafergen ICELL8 and the 10X Genomics Chromium Bulk RNA-seq的一些方法也适合于scRNA-seq，大多情况需要新的方法 单细胞RNA测序流程 分析方法scRNA-seq上游分析方法与bulk 相同，对测序数据进行质控、比对、比对结果的质控（黄色部分），接着是细胞质控、标准化，这一部分与bulk有相同的也有不同的地方，下游分析就是解释实际生物学问题，包括差异分析、聚类、网络分析等，所用的方法一般都是scRNA特有的算法。 scRNA-seq 分析的综述：(Stegle, Teichmann, and Marioni 2015) Falco ：云端处理scRNA-seq分析. SCONE (Single-Cell Overview of Normalized Expression), scRNA-seq质控和标准化的R包 Seurat ：scRNA-seq分析的常用的四大R包之一，包括对数据的质控、分析等 ASAP (Automated Single-cell Analysis Pipeline) ：scRNA-seq交互分析的网络平台 挑战bulk RNA-seq与scRNA-seq最主要的不同是scRNA-seq的每个测序文库代表一个细胞而不是一群细胞。文库的不同来源于： 扩增 (达到1 million倍) Gene ‘dropouts’：指一个细胞在一个细胞中是中等表达水平，但是在另一个细胞中没有被检测到 上面的差异主要来自于RNA的起始量很低，因此提高转录本的捕获率、降低扩增偏差是一个热门的研究方向。 实验方法发展新的scRNA-seq protocol也是一个热门领域，目前已有的方法包括： CEL-seq (Hashimshony et al. 2012) CEL-seq2 (Hashimshony et al. 2016) Drop-seq (Macosko et al. 2015) InDrop-seq (Klein et al. 2015) MARS-seq (Jaitin et al. 2014) SCRB-seq (Soumillon et al. 2014) Seq-well (Gierahn et al. 2017) Smart-seq (Picelli et al. 2014) Smart-seq2 (Picelli et al. 2014) SMARTer STRT-seq (Islam et al. 2013) 不同的方法实现方式不同，其中定量和捕获是最重要的两个方面 定量有两种类型： 全长（full length): 致力于实现每个转录本一致的read coverage 理论上的一致的coverage很难实现，经常会存在偏差 基于标签(tag-based): 只捕获RNA的5‘ 端或3’端， 可以和UMI(unique molecular identifiers )结合提高定量准确性 由于只捕获单端RNA可能会降低比对率 很难鉴定isoforms 捕获： 捕获策略决定了测序通量，以及得到细胞的方式和其他信息。常用的捕获策略有： microwell-based 使用吸液管或激光捕获等方法分离细胞，并将其放置在微流体管中。该方法的优缺点是： 优点是：可以与FACS分选结合使用，从而可以根据细胞表面marker筛选感兴趣的特定类型的细胞，同时在分选时可以拍摄细胞。图像可以用于识别受损细胞或dublets。 缺点是：通量低、耗时费工 microfluidic-based 如Fluidigm’s C1，提供了一个更为集成的系统，用于捕捉细胞和进行建库准备所需的反应。 优点是：通量比microwell-based 高 缺点是：捕获效率低，只有10%的细胞可以被捕获，因此不适用于细胞类型罕见或者输入细胞量少的研究；另外芯片价格相对贵 droplet- based 将每一个细胞封装在一个毫微升的液滴中，并加上一个珠子（bead), bead中含有建库所需的酶和唯一的条形码（barcode)，条形码可以将reads来自于哪个细胞关联。因此，所有的液滴都可以汇集起来，排序在一起，然后根据条形码将reads分配给原始细胞。 优点是：通量最高 缺点是：测序成本、低覆盖率 (Ziegenhain et al. 2017) 如何选择合适的平台如何选择合适的protocols，只有根据研究的生物学问题。如果感兴趣一个组织的组成，那么droplet-based的方法可以得到大量的细胞，或许是最适合的；如果研究的是罕见细胞，并且知道细胞marker,那么结合FACS富集，测少量的细胞也可以实现目的。 全长转录本适合于对不同亚型感兴趣的研究，tagged的protocols可以和UMI结合，适用于基因水平的定量。 内容来自Hemberg lab’s 单细胞课程学习笔记 ： Introduction to single-cell RNA-seq： https://scrnaseq-course.cog.sanger.ac.uk/website/introduction-to-single-cell-rna-seq.html]]></content>
      <categories>
        <category>组学</category>
        <category>转录组</category>
      </categories>
      <tags>
        <tag>single cell</tag>
        <tag>scRNA-seq</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[使用BETA整合分析ATAC-seq/ChIP-seq和RNA-seq数据]]></title>
    <url>%2F2019%2F08%2F23%2F%E4%BD%BF%E7%94%A8BETA%E6%95%B4%E5%90%88%E5%88%86%E6%9E%90ATAC-seq%3AChIP-seq%E5%92%8CRNA-seq%E6%95%B0%E6%8D%AE%2F</url>
    <content type="text"><![CDATA[BETA 网址: http://cistrome.dfci.harvard.edu/BETA/tutorial.html 功能介绍 数据准备： peak bed file 123456# chr str end$head mep_ebDfpeak_deseq2_sig.bedchr8 12050808 12052743chr9 66492999 66494729chr4 125632449 125634758chr4 10182030 10183501 df expression file 12345678# symbol log2FC pvalue$head mep_eb_dfexpreMELK 6.23721078699297 5.47784458574045e-218RAD51AP1 4.17541170218602 2.86774188064759e-217HMGN5 5.98876520905166 7.49359285750074e-216ZWILCH 3.74468061674801 2.42032701371558e-204HNRNPA2B1 2.76252025379004 3.05116228100538e-190HLA-DRA -5.19413815362273 2.27680965999626e-188 软件下载安装1234wget http://cistrome.dfci.harvard.edu/BETA/src/BETA_1.0.7.zipunzip BETA_1.0.7.zipcd BETA_1.0.7/sudo python setup.py install 使用BETA BasicBETA Basic 预测调控因子的功能（激活或抑制）和靶基因1BETA basic –p 3656_peaks.bed –e AR_expr.xls –k LIM –g hg19 --da500 –n basic 参数：-p ： peak bed file (必需参数）-e：df expression file (必需参数）-k：表达量文件格式是limma的标准格式（根据实际情况修改）-g：基因组文件，如hg19,hg38,mm10,mm9-n：输出文件前缀，BETA默认是NA-da：选择显著性变化（上调和下调的）表达数据（根据实际情况修改） 其他格式(不是limma和cuffdif标准格式）的差异表达文件格式： 需设置参数--info, geneID如果是smbol需要设置--gname2 BETA PlusBETA Plus 预测调控因子的功能（激活或抑制）和靶基因，以及靶向区域的motif分析 1BETA plus –p 3656_peaks.bed –e AR_expr.xls –k LIM –g hg19 --gs hg19.fa --bl 参数： --gs : motif分析需要的参数, 基因组fasta格式--bl :可选参数，当考虑boundary（如CTCF）时需要的参数 BETA MinusBETA Minus 只根据peak bed数据基于调控潜能值预测靶基因1BETA minus -p 3656_peaks.bed --bl -g hg19 其他可选参数-n：结果文件的名字-o:输出文件路径--gname2：geneID如果是smbol需要设置--gname2--info：其他格式(不是limma和cuffdif标准格式）的差异表达文件格式：需设置参数--info,--pn:peak 数目，默认是10，000-d DISTANCE,--distance 距离TSS的距离. DEFAULT=100000 (100kb)--df DIFF_FDR : 输入0-1的数值，表示统计的阈值，如FDR等，默认是1.--da DIFF_AMOUNT; 取显著表达的基因，0-1表示比例，大于1表示个数。如2000，表示去top 2000个上调和下调的差异基因；0.5表示取50%上调和下调的基因，默认是0.5。-c CUTOFF, --cutoff： 0~1的一个阈值。默认是1e-3。-r REFERENCE, --reference： 当参考基因组不是hg19,或mm9时使用此参数。--bl BOUNDARY :LIMIT Boolean Value. Whether or not use CTCF boundary to get a peak’s associated gene, DEFAULT=FALSE-bf BOUNDARYFILE : Some BED format boundary file, use this only when You set –bl and the genome is neither hg19 nor mm9 相关资料文章Wang, S., Sun, H., Ma, J., Zang, C., Wang, C., Wang, J., … &amp; Liu, X. S. (2013). Target analysis by integration of transcriptome and ChIP-seq data with BETA. Nature protocols, 8(12), 2502-2515.PMID: 24263090网址： http://cistrome.org/BETA/index.html 使用代码1/software/biosoft/software/python/python2.7/bin/BETA plus -P mep_ebDfpeak_deseq2_sig.bed --info -e mep_eb_dfexpre --gname2 -g hg 19 --gs hg19.fa --bl 几点疑问BETA最初的设计主要是用于ChIP-Seq和RNA-seq的整合分析，最终可以预测特定一个转录因子的靶基因，以及这些基因是激活还是抑制的功能。但是对于ATAC-seq，它得到的信号整个基因组范围转录因子的信号，那么与转录组整合分析得到的结果怎么解释？只能知道一些基因的功能是激活的或抑制的，但是并不能知道这些基因是哪些转录因子的靶基因。所以BETA是否适合ATAC-seq和与RNA-seq的整合分析？如果可以，整合分析的结果能得到哪些有价值的信息？]]></content>
      <categories>
        <category>文献</category>
        <category>methods</category>
      </categories>
      <tags>
        <tag>ATACseq</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[转录因子足迹分析+启动子处染色质可及性与基因表达不一定成正相关]]></title>
    <url>%2F2019%2F08%2F23%2F%E8%BD%AC%E5%BD%95%E5%9B%A0%E5%AD%90%E8%B6%B3%E8%BF%B9%E5%88%86%E6%9E%90%2B%E5%90%AF%E5%8A%A8%E5%AD%90%E5%A4%84%E6%9F%93%E8%89%B2%E8%B4%A8%E5%8F%AF%E5%8F%8A%E6%80%A7%E4%B8%8E%E5%9F%BA%E5%9B%A0%E8%A1%A8%E8%BE%BE%E4%B8%8D%E4%B8%80%E5%AE%9A%E6%88%90%E6%AD%A3%E7%9B%B8%E5%85%B3%2F</url>
    <content type="text"><![CDATA[题目：Identification of transcription factorbinding sites using ATAC-seqDOI: 10.1186/s13059-019-1642-2杂志/日期：Genome Biol. , 26 Feb 2019关键词：ATAC-seq; Computational footprinting 日期：2019年2月17日——2019-Week8 主要内容：这篇文章考虑到ATAC-seq实验的人工误差提出了第一个转录因子足迹的分析方法——HINT-ATAC，使用位置依赖模型探究转座酶的裂解偏好，观察到由局部核小体结构决定的转录因子结合位点周围的特异剪接模式，因此，HINT-ATAC可以更好的预测转录因子的结合位点。 题目：Combined analysis of dissimilar promoter accessibility and gene expression profiles identifies tissue-specific genes and actively repressed networksDOI: https://doi.org/10.1186/s13072-019-0260-2杂志/日期：Epigenetics &amp; Chromatin, 12 Feb 2019关键词：ATAC-seq; promoter 日期：2019年2月17日——2019-Week8 主要内容：许多研究都报道了启动子处的染色质可及性与基因表达成正相关，而这篇文章发现了一个不一样的趋势。他们发现相关性最强（高表达，强的染色质可及性）的可能与管家基因功能相关。组织特异性基因表达量高，但是染色质可及性仅为中低水平的coverage。此外，他们预测到中、低表达的、但是有高启动子覆盖的基因被积极抑制。]]></content>
      <categories>
        <category>文献</category>
        <category>ideas</category>
      </categories>
      <tags>
        <tag>ATACseq</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[scATAC-seq分析工具]]></title>
    <url>%2F2019%2F08%2F23%2FscATAC-seq%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%2F</url>
    <content type="text"><![CDATA[题目：Destin: toolkit for single-cell analysis of chromatin accessibility DOI: https://doi.org/10.1093/bioinformatics/btz141杂志/日期： Bioinformatics, 01 March 2019关键词： scATAC-seq，GWAS分类：「工具」日期：2019年2月10日——2019-Week7 主要内容：「Destin」用于scATAC-seq分析的一个R工具包，其中的一个亮点是分析GWAS结果是否与特定细胞类型集群中染色质可及性的增加有关，这里他们采用的是最初用于scRNA -seq表达的两种方法:ECWE和MAGMA。除此之外还包括： 从bam文件获取实验信息 peaks的注释区域 质控 确定分群数量 差异可及性染色质（其中输入文件是peaks，cell的bam文件） 总结「Destin」用于sc-ATAC分析的一个R工具包，包括分群，与gwas关联，差异peaks分析等。 相关资料 github : https://github.com/urrutiag/destin 题目： A rapid and robust method for single cell chromatin accessibility profiling DOI: https://www.nature.com/articles/s41467-018-07771-0杂志/日期： Nature Communications, 17 December 2018关键词： scATAC-seq，分类：「工具」日期：2019年2月10日——2019-Week7 主要内容：plate-based的scATAC-seq方法，结合了前期bulk Tn5单核分选标签。 相关资料：代码：https://github.com/dbrg77/plate_scATAC-seq.数据：bulk ATAC 和scATAC-seq :http://genome-euro.ucsc.edu/cgi-bin/hgTracks?hgS_doOtherUser=submit&amp;hgS_otherUserName=dbrg77&amp;hgS_otherUserSessionName=mSpleen_scATAC_cluster.]]></content>
      <categories>
        <category>文献</category>
        <category>methods</category>
      </categories>
      <tags>
        <tag>ATACseq</tag>
        <tag>scATACseq</tag>
        <tag>文献摘要</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[esATAC_一个ATAC-seq分析的R包]]></title>
    <url>%2F2019%2F08%2F23%2FesATAC_%E4%B8%80%E4%B8%AAATAC-seq%E5%88%86%E6%9E%90%E7%9A%84R%E5%8C%85%2F</url>
    <content type="text"><![CDATA[日期：2019年1月13日——2019-Week2分类：「工具」题目：esATAC: An Easy-to-use Systematic pipeline for ATAC-seq data analysisDOI: 10.1093/bioinformatics/bty141杂志：Bioinformatics，2018 Aug关键词： ATAC; chromatin accessibility; transcription factor; regulatory network 介绍之前介绍过中科大Kun Qu老师实验室开发的用于bulk ATAC-seq分析的工具包 —— 「ATAC-pipe」，虽然个人并不推荐依赖使用这种打包工具包。但是他们的分析方法和原理还是值得了解和学习的。这里再介绍一个ATAC-seq分析的工具包——esATAC，是由清华大学Xiaowo Wang老师实验室开发的一个R/Bioconductor包，它的功能包括如下几方面： 原始数据的质控和比对 peak calling 富集分析 转录因子足迹分析 具体分析方法参考vignettes:https://www.bioconductor.org/packages/release/bioc/vignettes/esATAC/inst/doc/esATAC-Introduction.html 数据分析流程 初始数据：可以直接处理fastq格式的测序数据 质控：多种质控方法，包括测序质量，read length分布等 去接头：AdapterRemoval 比对：Bowtie2 鉴定开放染色质peak：F-seq？？仔细了解(Boyle, et al., 2008,Koohy, et al., 2014) peak的注释：ChIPseeker包 TF分析：结合JASPAR数据库 适用物种：人和鼠 单细胞RNA-seq、ATAC-seq分析教程、工具大集锦: https://github.com/seandavi/awesome-single-cell]]></content>
      <categories>
        <category>文献</category>
        <category>methods</category>
      </categories>
      <tags>
        <tag>ATACseq</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ATAC-pipe_ATAC-seq分析的工具包]]></title>
    <url>%2F2019%2F08%2F23%2FATAC-pipe_ATAC-seq%E5%88%86%E6%9E%90%E7%9A%84%E5%B7%A5%E5%85%B7%E5%8C%85%2F</url>
    <content type="text"><![CDATA[日期：2019年1月6日——2019-Week1分类：「工具」题目：ATAC-pipe: general analysis of genome-wide chromatin accessibilityDOI: 10.1093/bib/bby056杂志：Briefings in Bioinformatics关键词： ATAC; chromatin accessibility; transcription factor; regulatory network 摘要ATAC-pipe是中科大Kun Qu实验室开发的一个打包软件包，用于分析bulk ATAC-Seq。主要功能包括： 鉴定显著差异的开放染色质区域 motif分析及相关的TFs对转录调控的影响 TF和motif的足迹分析以及核小体占位的可视化 基于相关性的细胞聚类分析 构建TF调控网络，评估TFs和基因间的相互作用 详细用法参考： https://github.com/QuKunLab/ATAC-pipe或者 manual for ATAC-pipe:https://github.com/QuKunLab/ATAC-pipe/blob/master/Manual_for_ATAC-pipe.pdf 材料和方法1. 流程和算法ATAC-pipe是基于其他工具和软件包的，需要在Linux/MAC OS平台安装 requires Bowtie2, Picard, MACS2, HOMER, Python和R的环境，以及相关的参考基因组和DESeq R包。 比对: Bowtie2 去重: Picard peak calling: MACS2 count标准化和差异分析：DESeq 聚类和热图：Cluster 3.0 和 Treeview TF motifs分析: Homer and msCentipede 序列迁移，TSS富集值和分布，V-plot, TF调控网络：他们自己实验室写的代码 2. 与其他工具的比较他们的介绍是「ATAC-pipe功能多，其他工具可能只是包含QC，比对，peak calling等基本步骤，但是ATAC-pipe还包含样本聚类，motif 搜索，足迹验证、核小体占位分析和TF调控网络分析，而且更重要的是可以鉴定显著差异开放染色质区域和这些区域的TF motif富集, 另外所需时间与其他工具相比较少」。（他们介绍的优点了解下即可，其实很多工具都可以实现相同的功能,其他工具的功能和原理也要了解一下） 结果看一下这个流程包可以给出哪些结果 结果1：质控 结果2：相关性和差异peaks分析 结果3：TF 富集分析 结果4：TF motif足迹分析和核小体占位分析 结果5：TF驱动调控网络讨论使用他人打包的工具包有人可能觉得省时方便，但是会有很多限制，不够灵活。而且他们这个工具包本身需要安装很多工具，最终是包装成python模块，使用时是需要有linux和python基础的。他们的分析结果有很多工具和方法可以实现，对于这篇文章也就是了解下他们进行ATAC-seq分析时使用的方法，同时了解下文章中做比较时提到其他工具。 如果想实现个性化和弹性化的分析，还是需要自己了解掌握每一步的分析流程，具体方法可以参考之前的帖子: ATAC-Seq入门加高阶传送门，文末点击可进入交流群https://mp.weixin.qq.com/s/iVMY_0Su278OfWc2r2_brQ 第10篇：ATAC-Seq、ChIP-Seq、RNA-Seq整合分析（内附目录）https://mp.weixin.qq.com/s/7k2GEmPmnkVfmzegpxabQA 给学徒的ATAC-seq数据实战（附上收费视频）https://mp.weixin.qq.com/s/XQITfdnS6Zn6iTBtuladPw 另外记得在去年苏州单细胞会议的海报展示，Kun Qu老师实验室展示了一个用于sc-ATAC分析的工具包APEC（不知道发表没）。APEC的文章已在预印版上发出：https://www.biorxiv.org/content/early/2019/05/23/646331.full.pdf]]></content>
      <categories>
        <category>文献</category>
        <category>methods</category>
      </categories>
      <tags>
        <tag>ATACseq</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[第10篇：ATAC-Seq、ChIP-Seq、RNA-Seq整合分析]]></title>
    <url>%2F2019%2F08%2F23%2F%E7%AC%AC10%E7%AF%87%EF%BC%9AATAC-Seq%E3%80%81ChIP-Seq%E3%80%81RNA-Seq%E6%95%B4%E5%90%88%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[由于基因表达调控机制的复杂性，多种组学数据的整合分析，从不同的层面探究生物问题越来越重要。从RNA-Seq层面，我们可以探究哪些基因具有显著差异，上调或下调；从ChIP-Seq层面，我们可以研究某个特定转录因子的调控作用；从ATAC-Seq我们可以了解到染色质可及性的动态变化，由于染色质的可及性与调控元件或转录因子的结合密切相关，在转录调控中发挥着重要的作用。因此，整合分析可以进一步探究调控某一生物学过程的关键因子（包括顺式调控元件和转录因子），以及哪个转录因子调控了感兴趣的基因，以及感兴趣的转录因子的靶基因等。目前，好像并没有标准化的方法用来整合比较这三种数据。不过在文献中可以看到有很多相同的或不同的思路和方法做整合分析，大家可以在学习交流群中推荐文献，一起解读学习。 下面的内容主要介绍这一节课程中RNA-Seq和ChIP-Seq的整合分析中提到的两种方法：一是直接比较，即首先得到差异基因与ChIP-Seq靶基因的overlap，然后选择一些关键基因比较一下谱图。课程中提到的另一种方法是使用BETA工具：BETA (Binding and Expression Target Analysis)是 Shirley Liu实验室开发的工具，通过整合转录因子或染色质调控因子的ChIP-Seq与差异基因的表达直接预测靶基因，而且有可能发现增强子区的蛋白质的靶基因。BETA有三个功能： 预测转录因子的功能是激活还是抑制 预测转录因子的靶基因 鉴定转录因子的motif以及调控转录因子激活或抑制的其他因子 BETA包括三个命令取决于输入数据格式和想要的输出数据（可以参考嘉因的帖子ChIP-seq和RNA-seq整合分析，BETA最擅长 | 自己分析数据的完美解决方案） BETA basic: 预测转录因子的功能是激活还是抑制，直接检测靶标 BETA plus：BETA basic + 靶标区域的motif分析 BETA minus：只基于结合数据的调控潜能的值预测TF靶基因 工作原理 每个基因的调控潜能值是通过计算基因TSS的指定范围内的所有结合位点来计算的 调控潜能是基因受因子调节的可能性，取决于TSS范围的结合位点数以及与结合位点与TSS之间的距离 BETA minus按照调控潜能值对基因排序来鉴定靶标 BETA basic需要特定格式的差异分析结果和显著性的结果。它使用CDF来判断上调基因和下调基因是否与NON-DE不同，这是用来识别激活和抑制功能。使用调控潜能和差异统计量计算每一个基因的得分排序，该得分排序可以用于识别靶标。参考资料： 哈佛深度NGS数据分析课程，10-Integrating RNA-seq and ChIP-seq 大牛新宠，转录调控研究神器！找关键转录因子、推测转录因子-靶基因关系]]></content>
      <categories>
        <category>组学</category>
        <category>表观组</category>
      </categories>
      <tags>
        <tag>ATACseq</tag>
        <tag>ChIPseq</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[第9篇：差异peaks分析——DiffBind]]></title>
    <url>%2F2019%2F08%2F23%2F%E7%AC%AC9%E7%AF%87%EF%BC%9A%E5%B7%AE%E5%BC%82peaks%E5%88%86%E6%9E%90%E2%80%94%E2%80%94DiffBind%2F</url>
    <content type="text"><![CDATA[学习目标 学习用DiffBind流程评估两个样本间的差异结合区域 用PCA评估样本间的关系 评估不同工具得到的差异peaks的一致性 评估差异peaks富集的工具ATAC-Seq下游分析的另一个重点是差异peaks分析。如分析不同的实验条件、多个时间节点、不同的发育时期等的差异区域。鉴定这些差异peaks区域在生物医学研究中也具有重要意义，目前也有多种相关的工具被开发：选择合适的工具需考虑以下几个因素： 所用的软件不需要大量的代码移植，该工具是否被维护和频繁更新。 用户需要提供什么样的输入文件，是否与peaks calling所用工具可以衔接。 信号分布的基础统计模型是什么？是基于泊松分布或更灵活的负二项分布。 一些工具是专门针对特定的ATAC-seq或ChIP-seq 数据（信号类型）设计的，如组蛋白修饰或转录因子（TF）结合。 具体选择哪种工具决定于实验设计，下面的决策树可以帮助缩小你的选择范围。 DiffBindDiffBind是鉴定两个样本间差异结合位点的一个R包。主要用于peak数据集，包括对peaks的重叠和合并的处理，计算peaks重复间隔的测序reads数，并基于结合亲和力鉴定具有统计显著性的差异结合位点。适用的统计模型有DESeq、DESeq2、edgeR。详细内容可参考DiffBind的文档：http://bioconductor.org/packages/release/bioc/vignettes/DiffBind/inst/doc/DiffBind.pdf 使用方法：1. 下载安装DiffBind1234source("https://bioconductor.org/biocLite.R")biocLite("DiffBind")# view documentationbrowseVignettes("DiffBind") 2. 准备输入文件需要准备一个SampleSheet文件，与ChIPQC的方法一样。SampleSheet文件是根据实验设计和数据存储地址等信息创建的一个csv格式文件，包含的表头信息有“SampleID”、 “Tissue”、 “Factor”、 “Condition” 、”Treatment”、”Replicate” 、”bamReads” 、”ControlID”、 “bamControl” “Peaks”、 “PeakCaller”（bam,peak文件分别在比对和call peak的步骤产生）。 3. 差异peaks分析读入文件一旦读入了peaksets，合并函数就找到所有重叠的peaks，并导出一致性的peaksets。12library(DiffBind)dbObj &lt;- dba(sampleSheet="SampleSheet.csv") 亲和结合矩阵计算每个peaks/regions的count信息。先对一致性的peaks数据集进行标准化，然后根据他们的峰值（point of greatest read overlap）再次中心化并修剪一些peaks，最终得到更加标准的peak间隔。使用函数dba.count()，参数bUseSummarizeOverlaps可以得到更加标准的计算流程。123dbObj &lt;- dba.count(dbObj, bUseSummarizeOverlaps=TRUE)dba.plotPCA(dbObj, attributes=DBA_FACTOR, label=DBA_ID)plot(dbObj) 结果中同时计算了FRiP (质量评估的一个标准，可以参考第5篇：对ATAC-Seq/ChIP-seq的质量评估（二）——ChIPQC)。样本间的聚类:Venn图展示样本间peaks的重合差异分析差异分析是DiffBind的核心功能，默认情况是基于DEseq2, 可以设置参数method=DBA_EDGER选择edgeR，或者设置method=DBA_ALL_METHODS。每种方法都会评估差异结果的p-vaue和FDR。 1234567# Establishing a contrast dbObj &lt;- dba.contrast(dbObj, categories=DBA_FACTOR,minMembers = 2)dbObj &lt;- dba.analyze(dbObj, method=DBA_ALL_METHODS)# summary of resultsdba.show(dbObj, bContrasts=T)# overlapping peaks identified by the two different tools (DESeq2 and edgeR)dba.plotVenn(dbObj,contrast=1,method=DBA_ALL_METHODS) 提取结果12comp1.edgeR &lt;- dba.report(dbObj, method=DBA_EDGER, contrast = 1, th=1)comp1.deseq &lt;- dba.report(dbObj, method=DBA_DESEQ2, contrast = 1, th=1) 结果文件包含所有位点的基因组坐标，以及差异富集的统计数据包括fold change、p值和FDR。其中Conc的表示read的平均浓度，即对peak 的read counts进行log2标准化 The value columns show the mean read concentration over all the samples (the default calculation uses log2 normalized ChIP read counts with control read counts subtracted) and the mean concentration over the first (Resistant) group and second (Responsive) group. 保存文件123456# EdgeRout &lt;- as.data.frame(comp1.edgeR)write.table(out, file="results/Nanog_vs_Pou5f1_edgeR.txt", sep="\t", quote=F, col.names = NA)# DESeq2out &lt;- as.data.frame(comp1.deseq)write.table(out, file="results/Nanog_vs_Pou5f1_deseq2.txt", sep="\t", quote=F, col.names = NA) 以bed格式保存显著性的差异结果123456789101112# Create bed files for each keeping only significant peaks (p &lt; 0.05)# EdgeRout &lt;- as.data.frame(comp1.edgeR)edge.bed &lt;- out[ which(out$FDR &lt; 0.05), c("seqnames", "start", "end", "strand", "Fold")]write.table(edge.bed, file="results/Nanog_vs_Pou5f1_edgeR_sig.bed", sep="\t", quote=F, row.names=F, col.names=F)# DESeq2out &lt;- as.data.frame(comp1.deseq)deseq.bed &lt;- out[ which(out$FDR &lt; 0.05), c("seqnames", "start", "end", "strand", "Fold")]write.table(deseq.bed, file="results/Nanog_vs_Pou5f1_deseq2_sig.bed", sep="\t", quote=F, row.names=F, col.names=F) 参考资料 DiffBind文档 哈佛深度NGS数据分析课程， 09- Differential Peak calling using DiffBind]]></content>
      <categories>
        <category>组学</category>
        <category>表观组</category>
      </categories>
      <tags>
        <tag>ATACseq</tag>
        <tag>ChIPseq</tag>
        <tag>差异分析</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[第8篇：用网页版工具做功能分析和motif分析]]></title>
    <url>%2F2019%2F08%2F23%2F%E7%AC%AC8%E7%AF%87%EF%BC%9A%E7%94%A8%E7%BD%91%E9%A1%B5%E7%89%88%E5%B7%A5%E5%85%B7%E5%81%9A%E5%8A%9F%E8%83%BD%E5%88%86%E6%9E%90%E5%92%8Cmotif%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[上一篇介绍了使用ChIPseeker对peaks的分布和邻近基因的注释。除此之外，下游分析通常还包括鉴定我们感兴趣的蛋白质结合的motif；鉴定这些结合区域的基因以及这些基因的富集通路或网络。 学习目标 功能富集分析: [GREAT](http://bejerano.stanford.edu/great/public/html/index.php) motif分析:MEME套件，如DREME(http://meme-suite.org/tools/dreme), MEME-ChIP (http://meme-suite.org/tools/meme-chip) 准备文件提取IDR结果文件的前3列1cut -f 1,2,3 Nanog-idr-merged.bed &gt; Nanog-idr-merged-great.bed 使用bedtools getfasta提取peaks的序列1234bedtools getfasta -fi \ref_genome.fa \-bed Nanog-idr-merged-great.bed \-fo Nanog-idr-merged-dreme.fasta 富集分析GREAT(http://bejerano.stanford.edu/great/public/html/index.php)对peaks的功能注释是对peaks临近基因的注释。方法： 1.打开GREAT网站：http://bejerano.stanford.edu/great/public/html/index.php 。上传Nanog-idr-merged-great.bed文件，选择参考基因组，选择Whole genome作为背景区域，然后点击Submit。 点开Job Description,选择View all genomic region-gene associations，结果中的两个表给出peaks注释到的基因，一个是基因组区域和基因关联的表，一个是基因和基因组关联的表： Region-Gene Association Graphs这栏内容对结合位点的基因数和转录起始位点相关的基因做了图形展示。 Global Controls选择想注释的信息，如GO注释 探究Nanog结合位点相关的GO BP term 选择某个term,查看具体信息 打开This term&#39;s genomic region-gene association tables (140 regions, 116 genes)，查看注释到的GO term相关的基因，可以下载表格。 在This term&#39;s gene -&gt; genomic region association table中点击基因相关的regions，可以在UCSC浏览器上直接查看结合区域。 找Motifmotif是比较有特征的短序列，会多次出现的，并被假设拥有生物学功能。而且，经常是一些具有序列特异性的蛋白的结合位点（如转录因子）或者是涉及到重要生物过程的（如，RNA 起始，RNA 终止， RNA 剪切等等）。有很多网页版工具提供了找motif的方法，2014年的一篇综述列出了目前常用的网页工具（https://doi.org/10.1186/1745-6150-9-4 ）：最常用的有MEME工具套件，下面主要介绍DREME。DREME适用于大批量的ChIP-Seq数据找真核转录因子短的（4nt或8nt）核心DNA结合基序。 DREME 打开DREME网页 http://meme-suite.org/tools/dreme ，只要输入fasta序列Nanog-idr-merged-dreme.fasta即可，同时可以写上email和每个任务的描述，任务完成时如右图所示，可以打开DREAM_HTML_output查看结果。DREME’s HTML展示的结果包括找到的motif的序列logo和表示显著性的E-value。点击More可以查看更多的信息。Tomtom为了确定鉴定到的motif与已知转录因子的motif是否相似，可以将找到的motif再提交到Tomtom，与已知的转录因子数据库搜索匹配，同时还会给出motif-motif相似性的统计评估。在DREAM’s HTML结果中选择某个预测到的motif，点击Submit / Download,然后选择Tomtom，点击Submit，在新打开的Tomtom界面可以选择转录因子的参考数据库，保持默认参数不变，也可以再添加其他参数，输入邮箱和任务描述就可以开始搜索。MEME-ChIPMEME-ChIP是MEME套件中的另一个工具，可以实现DREAM和Tomtom的分析功能，还可以评估motifs的中心富集性并整合相关的motifs合成相似性簇。MEME-ChIP能够鉴定更长的motifs（&lt;30bp）,但是运行时间比较长。另外可以用Homer找motif，详细用法参考找个motif嘛，简单。参考资料 哈佛深度NGS数据分析课程, 08-Web-based functional analysis and motif discovery 找个motif嘛，简单]]></content>
      <categories>
        <category>组学</category>
        <category>表观组</category>
      </categories>
      <tags>
        <tag>ATACseq</tag>
        <tag>ChIPseq</tag>
        <tag>motif</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[第7篇：用Y叔的ChIPseeker对peaks进行注释和可视化]]></title>
    <url>%2F2019%2F08%2F23%2F%E7%AC%AC7%E7%AF%87%EF%BC%9A%E7%94%A8Y%E5%8F%94%E7%9A%84ChIPseeker%E5%AF%B9peaks%E8%BF%9B%E8%A1%8C%E6%B3%A8%E9%87%8A%E5%92%8C%E5%8F%AF%E8%A7%86%E5%8C%96%2F</url>
    <content type="text"><![CDATA[上一步骤（第6篇：重复样本的处理——IDR）用IDR对重复样本peaks的一致性进行了评估，同时得到了merge后的一致性的peaks——sample-idr，接下来就是对peaks的注释。这篇主要介绍用Y叔的R包ChIPseeker对peaks的位置（如peaks位置落在启动子、UTR、内含子等）以及peaks临近基因的注释。 ChIPseekerChIPseeker虽然最初是为了ChIP-seq注释而写的一个R包，但它不只局限于ChIP-seq，也可用于ATAC-Seq等其他富集peaks注释，也可用于lincRNA注释、DNA breakpoints的断点位置注释等所有genomic coordination的注释，另外提供了丰富的可视化功能。ChIPseeker的强大功能请参考Y叔的ChIP-Seq系列文章)，如：CS3: peak注释CS4：关于ChIPseq注释的几个问题CS6: ChIPseeker的可视化方法（中秋节的视觉饕餮） 使用方法使用ChIPseeker需要准备两个文件：一个就是要注释的peaks的文件，需满足BED格式。另一个就是注释参考文件，即需要一个包含注释信息的TxDb对象。Bioconductor提供了30个TxDb包，如果其中有研究的物种就可以直接下载安装此物种的TxDb信息。如果研究的物种没有已知的TxDb，可以使用GenomicFeatures包的函数（makeTxDbFromUCSC，makeTxDbFromBiomart）制作TxDb对象： makeTxDbFromUCSC： 通过UCSC在线制作TxDbmakeTxDbFromBiomart: 通过ensembl在线制作TxDbmakeTxDbFromGRanges：通过GRanges对象制作TxDbmakeTxDbFromGFF：通过解析GFF文件制作TxDb 制作TxDb方法示例（CS4：关于ChIPseq注释的几个问题）： 如用人的参考基因信息来做注释，从UCSC生成TxDb: 12library(GenomicFeatures)hg19.refseq.db &lt;- makeTxDbFromUCSC(genome="hg19", table="refGene") 用GFF文件做裂殖酵母的注释 12download.file("ftp://ftp.ebi.ac.uk/pub/databases/pombase/pombe/Chromosome_Dumps/gff3/schizosaccharomyces_pombe.chr.gff3", "schizosaccharomyces_pombe.chr.gff3")require(GenomicFeatures)spombe &lt;- makeTxDbFromGFF("schizosaccharomyces_pombe.chr.gff3") 具体步骤如下： 第1步：下载安装ChIPseeker注释相关的包从Bioconductor直接下载，或从github安装最新版本123456789101112131415source ("https://bioconductor.org/biocLite.R")biocLite("ChIPseeker")# 下载人的基因和lincRNA的TxDb对象biocLite("org.Hs.eg.db")biocLite("TxDb.Hsapiens.UCSC.hg19.knownGene")biocLite("TxDb.Hsapiens.UCSC.hg19.lincRNAsTranscripts")biocLite("clusterProfiler")#载入各种包library("ChIPseeker")library(clusterProfiler)library("org.Hs.eg.db")library(TxDb.Hsapiens.UCSC.hg19.knownGene)txdb &lt;- TxDb.Hsapiens.UCSC.hg19.knownGenelibrary("TxDb.Hsapiens.UCSC.hg19.lincRNAsTranscripts")lincRNA_txdb=TxDb.Hsapiens.UCSC.hg19.lincRNAsTranscripts 第2步：读入peaks文件函数readPeakFile读入peaks文件12nanog &lt;- readPeakFile("./idr_out.bed/nanog_idr-bed")pou5f1 &lt;- readPeakFile("./idr_out.bed/pou5f1_idr-bed") 第3步：注释peakspeaks的注释是用的annotatePeak函数，可以单独对每个peaks文件进行注释，也可以将多个peaks制作成一个list，进行比较分析和可视化。1234567# 制作多个样本比较的listpeaks &lt;- list(Nanog=nanog,Pou5f1=pou5f1)# promotor区间范围可以自己设定promoter &lt;- getPromoters(TxDb=txdb, upstream=3000, downstream=3000)tagMatrixList &lt;- lapply(peaks, getTagMatrix, windows=promoter)#annotatePeak传入annoDb参数,可进行基因ID转换（Entrez，ENSEMBL，SYMBOL，GENENAME）peakAnnoList &lt;- lapply(peaks, annotatePeak, TxDb=txdb,tssRegion=c(-3000, 3000), verbose=FALSE,addFlankGeneInfo=TRUE, flankDistance=5000,annoDb="org.Hs.eg.db") annotatePeak传入annoDb参数,即可进行基因ID转换，将Entrez ID转化为ENSEMBL，SYMBOL，GENENAME，peakAnnoList的结果如下： 12seqnames start end width strand annotation geneChr geneStart geneEnd geneLength geneStrand geneId transcriptId distanceToTSS ENSEMBL SYMBOL GENENAME flank_txIds flank_geneIds flank_gene_distances5 chr3 196625522 196625873 352 * Intron (uc003fwz.4/205564, intron 2 of 9) 3 196594727 196661584 66858 1 205564 uc011bty.2 30795 ENSG00000119231 SENP5 SUMO specific peptidase 5 uc003fwz.4;uc011bty.2 205564;205564 0;0 第4步：可视化提供了多种可视化方法，如plotAnnoBar(),vennpie(),plotAnnoPie(),plotDistToTSS()等，下面展示了两个样本在基因组特征区域的分布以及转录因子在TSS区域的结合。12plotAnnoBar(peakAnnoList)plotDistToTSS(peakAnnoList,title="Distribution of transcription factor-binding loci \n relative to TSS") 第5步：功能富集分析提取peakAnnolist中的基因，结合clusterProfiler包对peaks内的邻近基因进行富集注释。12345678910111213141516171819# Create a list with genes from each samplegene = lapply(peakAnnoList, function(i) as.data.frame(i)$geneId)# Run GO enrichment analysis ego &lt;- enrichGO(gene = entrez, keytype = "ENTREZID", OrgDb = org.Hs.eg.db, ont = "BP", pAdjustMethod = "BH", qvalueCutoff = 0.05, readable = TRUE)# Dotplot visualizationdotplot(ego, showCategory=50)# Multiple samples KEGG analysiscompKEGG &lt;- compareCluster(geneCluster = gene, fun = "enrichKEGG", organism = "human", pvalueCutoff = 0.05, pAdjustMethod = "BH")dotplot(compKEGG, showCategory = 20, title = "KEGG Pathway Enrichment Analysis") 第6步：保存文件123456# Output peakAnnolist filesave(peakAnnoList,file="peakAnnolist.rda")write.table(as.data.frame(peakAnnoList$Nanog),file="Nanog.PeakAnno",sep='\t',quote = F)# Output results from GO analysis to a tablecluster_summary &lt;- data.frame(ego)write.csv(cluster_summary, "results/clusterProfiler_Nanog.csv") 参考资料：ChIPseeker详细内容请参考: ChIPseeker文档 Y叔的ChIP-Seq系列：CS3: peak注释CS4：关于ChIPseq注释的几个问题CS6: ChIPseeker的可视化方法（中秋节的视觉饕餮） 哈佛深度NGS数据分析课程 07-ChIPseeker for ChIP peak Annotation, Comparison, and Visualization]]></content>
      <categories>
        <category>组学</category>
        <category>表观组</category>
      </categories>
      <tags>
        <tag>ATACseq</tag>
        <tag>ChIPseq</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[第6篇：重复样本的处理——IDR]]></title>
    <url>%2F2019%2F08%2F23%2F%E7%AC%AC6%E7%AF%87%EF%BC%9A%E9%87%8D%E5%A4%8D%E6%A0%B7%E6%9C%AC%E7%9A%84%E5%A4%84%E7%90%86%E2%80%94%E2%80%94IDR%2F</url>
    <content type="text"><![CDATA[前言ATAC-seq/ChIP-Seq中重复样本的处理 ATAC-Seq要求必须有2次或更多次生物学重复（十分珍贵或者稀有样本除外，但必须做至少2次技术重复）。理论上重复样本的peaks应该有高度的一致性，实际情况并不完全与预期一致。如何评价重复样本的重复性的好坏？如何得到一致性的peaks? 这一节将介绍两种方法：1. 用Bedtools进行简单的overlap合并重复样本2. 用IDR（Irreproducibility Discovery Rate）的方法获得高重复性的peaks 1. Overlapping peaks using bedtools如何得到两个重复样本间一致性的peaks? 一种简单粗暴的方法就是用bedtools计算peaks的overlaps。用法：bedtools intersect [OPTIONS] -a &lt;bed/gff/vcf/bam&gt; -b &lt;bed/gff/vcf/bam&gt; -a: 参数后加重复样本1（A） -b：参数后加重复样本2（B），也可以加多个样本 其他常用参数解释和图解如下： -wo：Write the original A and B entries plus the number of base pairs of overlap between the two features. -wa：Write the original entry in A for each overlap. -v：Only report those entries in A that have no overlaps with B如果只有-a和-b参数，返回的是相对于A的overlaps。加上参数-wo返回A和B原始的记录加上overlap的记录。参数-wa返回每个overlap中A的原始记录。使用代码示例：1234bedtools intersect \-a macs2/Nanog-rep1_peaks.narrowPeak \-b macs2/Nanog-rep2_peaks.narrowPeak \-wo &gt; bedtools/Nanog-overlaps.bed 2. Irreproducibility Discovery Rate (IDR)评估重复样本间peaks一致性的另一种方法是IDR。IDR是通过比较一对经过排序的regions/peaks 的列表，然后计算反映其重复性的值。IDR在ENCODE和modENCODE项目中被广泛使用，也是ChIP-seq指南和标准中的一部分。 IDR的 优点： 避免了初始阈值的选择，解决了不同callers的不可比较性 IDR不依赖于阈值的选择，所有regions/peaks都被考虑在内。 它是依赖regions/peaks的排序，不要求对输入信号进行校准或标准化IDR的详细说明参考: https://github.com/nboley/idr https://github.com/hbctraining/In-depth-NGS-Data-Analysis-Course/blob/master/sessionV/lessons/06_handling-replicates.md#irreproducibility-discovery-rate-idr 使用IDR的注意事项： 建议使用IDR时，MACS2 call peaks的步骤参数设置不要过于严格，以便鉴定出更多的peaks。 使用IDR需要先对MACS2的结果文件narrowPeak根据-log10(p-value)进行排序。 1234# Call peaksmacs2 callpeak -t sample.final.bam -n sample --shift -100 --extsize 200 --nomodel -B --SPMR -g hs --outdir Macs2_out 2&gt; sample.macs2.log#Sort peak by -log10(p-value)sort -k8,8nr NAME_OF_INPUT_peaks.narrowPeak &gt; macs/NAME_FOR_OUPUT_peaks.narrowPeak 使用IDR示例 123456idr --samples sample_Rep1_sorted_peaks.narrowPeak sample_Rep2_sorted_peaks.narrowPeak \--input-file-type narrowPeak \--rank p.value \--output-file sample-idr \--plot \--log-output-file sample.idr.log --samples:narrowPeak的输入文件（重复样本）--input-file-type：输入文件格式包括narrowPeak,broadPeak,bed--rank p.value：以p-value排序--output-file: 输出文件路径--plot：输出IDR度量值的结果 输出文件解读：详细内容可参考：https://github.com/nboley/idr#output-file-format 输出文件包括： sample-idr sample-idr.log sample-idr.png （1）sample-idrsample-idr是common peaks的结果输出文件，格式与输入文件格式类似，只是多了几列信息。前10列是标准的narrowPeak格式文件，包含重复样本整合后的peaks信息。 第5列：包含缩放的 IDR 值 score int如min(int(log2(-125IDR), 1000)，那么IDR=0，缩放的IDR就是1000；IDR=0.05, int(-125log2(0.05)) = 540；IDR=1.0, int(-125log2(1.0) = 0。 第11列和第12列：分别是local和global IDR值 col11: localIDR float -log10(Local IDR value) col12: globalIDR float -log10(Global IDR value)global IDR值是第5列中用于计算缩放的IDR值，类似于对p值进行多个假设校正以计算FDR；local IDR类似于属于不可重复噪声部分的峰值的后验概率。详细内容可阅读Measuring reproducibility of high-throughput experiments。 第13、14、15、16列：是重复样本1相关的信息。 col13: rep1_chromStart int col14: rep1_chromEnd int col15: rep1_signalValue float col16: rep1_summit int 第17-20列：是重复样本2相关的信息，和13-16四列信息类似。 其他列信息如下： col1: chrom string col2: chromStart int col3: chromEnd int col4: name string col6: strand [+-.] Use ‘.’ if no strand is assigned. col7: signalValue float col8: p-value float col9: q-value float col10: summit int wc -l *-idr 计算下common peaks的个数，接着可再计算下与总peaks的比率。如果想看IDR&lt;0.05的，可以通过第5列信息过滤：awk &#39;{if($5 &gt;= 540) print $0}&#39; sample-idr | wc -l（2）sample-idr.loglog文件会给出peaks通过IDR &lt; 0.05的比率，如下图所示（3）sample-idr.pngpng文件包括4个图 左上： Rep1 peak ranks vs Rep2 peak ranks, 没有通过特定IDR阈值的peaks显示为红色。右上：Rep1 log10 peak scores vs Rep2 log10 peak scores，没有通过特定IDR阈值的peaks显示为红色。下面两个图： Peak rank vs IDR scores，箱线图展示了IDR值的分布，默认情况下，IDR值的阈值为-1E-6。 参考资料：哈佛深度NGS数据分析课程06-Handling replicates in ChIP-Seq]]></content>
      <categories>
        <category>组学</category>
        <category>表观组</category>
      </categories>
      <tags>
        <tag>ATACseq</tag>
        <tag>ChIPseq</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[第5篇：对ATAC-Seq/ChIP-seq的质量评估（二）——ChIPQC]]></title>
    <url>%2F2019%2F08%2F23%2F%E7%AC%AC5%E7%AF%87%EF%BC%9A%E5%AF%B9ATAC-SeqChIP-seq%E7%9A%84%E8%B4%A8%E9%87%8F%E8%AF%84%E4%BC%B0%EF%BC%88%E4%BA%8C%EF%BC%89%E2%80%94%E2%80%94ChIPQC%2F</url>
    <content type="text"><![CDATA[1. 学习目标 讨论ChIP-seq数据质量评估的其他方法 用ChIPQC产生质量统计报告 鉴定低质量数据的来源 概览图 ENCODE评估数据质量采用多种指标，如前面已经讨论过的链相关的指标NSC和RSC。这一节将会讨论评估信号分布的其他指标。 NOTE：这里给出的评估指标只是反映数据质量的好坏，符合阈值的并不意味着实验是成功的，不符合阈值的也不一定意味着失败。 2.常见质量评估指标的介绍 SSDSSD值是对富集效果的评估。SSD值依赖于全基因组的pile-up信号强度，对真实的ChIP富集和干扰的强信号区域都很敏感。SSD值越大表明富集越好。 “It provides a measure of pileup across the genome and is computed by looking at the standard deviation of signal pile-up along the genome normalised to the total number of reads. ” FRiP:Fraction of reads in peaksFRiP表示的是peaks中的reads与总reads的比例。它是另一个反映样本富集效果或IP好坏的评价指标。可以理解为是“信噪比”即文库中结合位点片段占背景reads的比例。一个典型质量好的TF富集FRiP值约5%或者更高，polII的FRiP值约为30%或者更高，也有一些质量好的数据FRiP值&lt;1%（如RNAPIII） Relative Enrichment of Genomic Intervals (REGI)REGI是对peaks在不同基因组特征位点分布的统计。 RiBL: Reads overlapping in Blacklisted Regions过滤人工造成的高信号区域非常重要，如ENCIDE和modENCODE提供的DAC Blacklisted Regions track。这些区域经常在特定的重复序列处出现，如着丝粒、端粒、卫星重复序列等，通过简单的比对过滤是不能去除的。来自blacklisted regions的信号会造成call peak 和片段长度评估的混淆。RiBL值可以表示背景信号或input的信号水平，与input sample的SSD值以及input和ChIP sample的读长覆盖值相关。这些区域通常是基因组的0.5%，或者更高的比例（10%）。 3. ChIPQC: quality metrics reportChIPQC是一个Bioconductor包，输入文件包括BAM和peak文件，可以自动计算一些质量评估值，并产生质量报告。 准备数据 BAM files首先对比对过滤后的bam数据（chr12_aln.bam）建索引，然后将bam和index文件从~/ngs_course/chipseq/results/bowtie2移动到自己的目录文件夹data/bams peak files将narrowPeak 文件从macs2目录下~/ngs_course/chipseq/results/macs2 移动到自己目录下data/peakcalls sampleSheet filesampleSheet file是唯一需要自己根据实验设计和数据存储地址等信息创建的一个csv格式文件（bam,peak文件分别在比对和call peak的步骤产生）。sampleSheet具体需要包含的信息如下： SampleID: 样本ID Tissue, Factor, Condition: 不同的实验设计对照信息，三列信息必须包含在sampleSheet里，如果没有某一列的信息设为NA。 Replicate : 重复样本的编号 bamReads : 实验组BAM 文件的路径（data/bams） ControlID : 对照组样本ID bamControl :对照组样本的bam文件路径 Peaks :样本peaks文件的路径 PeakCaller ：peak类型的字符串，可以是raw,bed,narrow,macs等。下载安装ChIPQC12source("http://bioconductor.org/biocLite.R")biocLite("ChIPQC") Running ChIPQCChIPQC只需要三步就可以完成质量评估和报告生成。 首先载入包和sampleSheet信息 12345## Load librarieslibrary(ChIPQC)## Load sample datasamples &lt;- read.csv('meta/samplesheet_chr12.csv')View(samples) 创建ChIPQC对象利用sampleSheet的信息读取每个样本的bam和narrowpeak文件，并计算质量评估值，结果存在一个对象里。 12## Create ChIPQC objectchipObj &lt;- ChIPQC(samples, annotation="hg19") 生成ChIPQC报告 12## Create ChIPQC reportChIPQCreport(chipObj, reportName="ChIP QC report: Nanog and Pou5f1", reportFolder="ChIPQCreport") ChIPQC报告解读ChIPQC生成的结果包含一个网页报告和报告中含有的所有图片。网页报告有三部分：QC Summary ；QC Results；QC files and versions （1）QC Summary - Overview of resultsQC summary包含sampleSheet里填写的样本的基本信息Tissue,Factor,Condition,Replicate。另外还有上面提到的质量评估的常用指标SSD、RiP%和RiBL值。越高的SSD值表明富集效果越好，Pou5f1样本（2.6,3）有较高的SSD值，RiBL值不是很高，FRiP的比例在5%附近或者更高，除了Pou5f1-rep2。 SSD - SSD score (htSeqTools) RIP% - Percentage of reads wthin peaks RIBL% - Percentage of reads wthin Blacklist regions同时表格中还给出了其他统计信息： Reads - Number of sample reads within analysed chromosomes. Dup% - Percentage of MapQ filter passing reads marked as duplicates FragLen - Estimated fragment length by cross-coverage method FragLenCC - Cross-Coverage score at the fragment length RelativeCC - Cross-coverage score at the fragment length over Cross-coverage at the read length （2）QC Results - Full QC results and figures Mapping, Filtering and Duplication rate第一部分是比对、过滤和重复率质检结果，包括Table2 、Figure1和Figure2。Table 2主要给出了比对质量和重复率，因为BAM文件是过滤后的，所以这里Dup%都是0. Total Dup%-Percentage of all mapped reads which are marked as duplicates. Pass MapQ Filter%-Percentage of all mapped reads whichpass MapQ quality filter Pass MapQ Filter and Dup%-Percentage of all reads which pass MapQ filter and are marked asduplicates. Figure 1展现了reads在blacklists中的比例， Figure 2是用基因组注释呈现了reads在基因组特征位置如启动子的分布。这幅图里显示在启动子区域富集最明显。 ChIP signal Distribution and Structure第二部分是ChIP信号分布和结构组成，包括Figure3和4。Figure 3是一个coverage plot， x轴代表在某bp位置read pileup的高度，y轴代表有多少位置有相同的pileup 高度(取log)。**有好的富集的ChIP样本会有一个tail，即更多的位置（y值大）有较高的测序深度。在我们的数据集中Nanog样本与Pou5f1 相比有较高的tails,尤其是重复样本2。但是Pou5f1有较高的SSD值。当SSD高但是coverage看起来低时，可能是存在大片段深度高的区域出现在blacklist 基因组区域。 Peak Profile and ChIP Enrichment第3部分是peak的谱图和ChIP的富集，每个peak都集中在summit位置（summit 理解为peak的最高峰值点处）peak的性状取决于研究对象的类型，如转录因子、组蛋白标记、或其他DNA结合蛋白如聚合酶等，相同类型的对象通常有独特特征的谱图。Figure6和7都是对比对到peak中的reads统计。富集效果好的ChIP样本的reads与peaks会有高比例的重合。尽管Nanog有较高的RiP,但是两个重复样本间的差异大于Pou5f1。Figure8和9表示样本的聚类效果，分别是相关性聚类热图和PCA。4. 实验偏差：ChIP-seq数据质量低的来源 免疫沉淀的特异性和有效性影响因素如抗体的特异性，结和沉淀的强度 片段化超声裂解产生不同大小的片段可能引入偏差 文库构建时的偏差如PCR扩增参考资料：哈佛深度NGS数据分析课程05-ChIP-Seq Quality Assessment]]></content>
      <categories>
        <category>组学</category>
        <category>表观组</category>
      </categories>
      <tags>
        <tag>ATACseq</tag>
        <tag>ChIPseq</tag>
        <tag>QC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[第4篇：对ATAC-Seq/ChIP-seq的质量评估（一）——phantompeakqualtools]]></title>
    <url>%2F2019%2F08%2F23%2F%E7%AC%AC4%E7%AF%87%EF%BC%9A%E5%AF%B9ATAC-SeqChIP-seq%E7%9A%84%E8%B4%A8%E9%87%8F%E8%AF%84%E4%BC%B0%EF%BC%88%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94phantompeakqualtools%2F</url>
    <content type="text"><![CDATA[学习目标： 探讨ChIP-seq数据质量低的来源 理解链交叉相关性（ strand cross-correlation） 使用phantompeakqualtools计算交叉相关性和其他相关的质控度量值 评估交叉相关图 ChIP-Seq质量评估在下游分析前，最好是先对peak calling 后的ChIP-Seq数据进行质量评估。 链交叉相关（Strand cross-correlation）链交叉相关是一个有效的评估ChIP-Seq质量的方法，它不依赖于peak calling，而是基于ChIP-Seq实验。如果ChIP-Seq实验成功，DNA富集序列标签（蛋白质相互作用的序列）会在reads的双峰富集中产生显著的聚集。产生reads的双峰富集的原因如下：在ChIP-Seq实验中，DNA被片段化，蛋白质结合的片段会被免疫沉淀，所以产生了有蛋白质结合的DNA片段（fragments ）。DNA的正链从5’端开始被测序（如下图红色reads），DNA负链也从5’末端被测序产生如下图所示的蓝色reads。由于从DNA片段的5′末端测序，使+链reads的富集（下图中的蓝色部分）与负链reads的富集（下图红色部分）有少量的相互抵消区域。我们需要确定峰位移多少碱基数目可以在两个峰间产生最大的相关性。我们可以用交叉相关的度量值（cross-correlation metric）计算产生最大相关的位移。 交叉相关性度量值交叉相关度量是在Watson移动k个碱基后，计算Crick链与Watson链之间的Pearson线性相关。如下面的示意图：首先在链位移为0时，两个向量之间的Pearson相关值为0.539。 在链位移5bp，两个向量之间的Pearson相关值为0.931。 继续移动这些向量，对于每个链位移计算一个相关值。 最后，我们将有一个每个碱基对移位与皮尔森相关值的对应表。这是针对每个染色体的每一个峰计算的，然后该值乘以一个缩放因子，再对所有染色体的值相加，就可以绘交叉相关值（y轴）相对于移位值（x轴）生成的交叉相关图。典型的交叉相关图会产生两个峰：一个富集峰与主要的片段长度（predominant fragment length）相关（高相关性），另一个与read 长度（read length）相关，这个峰也被称为虚幻峰（“phantom” peak）。 质量好的ChIP-Seq数据集倾向产生一个大的片段长度峰（fragment-length peak），下图展示了一个来自于人细胞CTCF（zinc-finger transcription factor）的强信号。如果有好的抗体，转录因子通常产生45,000~60,000个peaks。下图红色的垂直线表示主峰的真实位移，蓝色的垂直线处有一个小的起伏表示read lenngth。 下图是weaker signal的一个示例。这里Pol2的抗体不是很有效，有分散的峰。交叉相关图中有两个峰，一个是真实的峰位移（185-200bp），另外一个在read length。信号弱的数据集中read length的峰会成为主峰。 一个失败的实验产生的交叉相关图类似于input，在fragment length处很少或没有峰，在read length处有信号非常强的。这种现象的原因可能是在结合位点附近fragments没有显著聚集。 交叉相关性质量评估度量值交叉相关谱图可以计算评估ChIP_Seq实验信噪比的度量值，并且实验设计确保fragment length准确。低信噪比和不准确的fragment length 表明ChIP-Seq实验可能有问题。Normalized strand cross-correlation coefficent (NSC)：NSC是最大交叉相关值除以背景交叉相关的比率(所有可能的链转移的最小交叉相关值)。NSC值越大表明富集效果越好，NSC值低于1.1表明较弱的富集，小于1表示无富集。NSC值稍微低于1.05，有较低的信噪比或很少的峰，这肯能是生物学真实现象，比如有的因子在特定组织类型中只有很少的结合位点；也可能确实是数据质量差。Relative strand cross-correlation coefficient (RSC):RSC是片段长度相关值减去背景相关值除以phantom-peak相关值减去背景相关值。RSC的最小值可能是0，表示无信号；富集好的实验RSC值大于1；低于1表示质量低。 phantompeakqualtoolsphantompeakqualtools 是一个用于计算ChIP-Seq数据富集和质量度量值的一个工具包。我们将使用该包来计算基于链交叉相关峰的主要插入大小(fragment length)和基于相对phantom peak的数据质量度量值。phantompeakqualtools是一个R包，依赖samtools。下载phantompeakqualtools12345wget https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/phantompeakqualtools/ccQualityControl.v.1.1.tar.gztar -xzf ccQualityControl.v.1.1.tar.gzcd phantompeakqualtools# 查看READMEless README.txt Linux下安装12R install.packages("caTools", lib="~/R/library") 运行phantompeakqualtools 1234567mkdir -p logs qualfor bam in bam_dir/sample1.final.bam bam_dir/sample2.final.bamdo bam2=`basename $bam .final.bam`Rscript run_spp_nodups.R -c=$bam -savp -out=qual/$&#123;bam2&#125;.qual &gt; logs/$&#123;bam2&#125;.Routdone 参数含义： -c: 比对过滤后的bam文件的全路径和名字 -savp:保存交叉相关图 -out：会产生数据集重要特征值的输出文件 输出文件解读输出文件会产生一个tab分割的名为qual的文件,包含的信息如下： COL1：Filename：比对过滤的bam文件名 COL2：numReads ：有效的测序深度 COL3：estFragLen：逗号分隔的交叉相关峰以相关性递减顺序排列的值 COL4: corr_estFragLen: 逗号分隔的以递减顺序排列交叉相关值 COL5: phantomPeak: Read length/phantom peak链位移 COL6: corr_phantomPeak: phantom peak相关值 COL7: argmin_corr:交叉相关最小的链位移 COL8: min_corr:交叉相关最小值 COL9: Normalized strand cross-correlation coefficient (NSC) = COL4 / COL8 COL10: Relative strand cross-correlation coefficient (RSC) = (COL4 - COL8) / (COL6 - COL8) COL11: QualityTag: Quality tag based on thresholded RSC (codes: -2:veryLow,-1:Low,0:Medium,1:High,2:veryHigh)我们最关注的值是第9列和第11列。Cross-correlation plots课程中的示例数据Nanog_rep1的交叉相关图 参考资料哈佛深度NGS数据分析课程04_ChIP-Seq Quality Assessment: Cross-correlation]]></content>
      <categories>
        <category>组学</category>
        <category>表观组</category>
      </categories>
      <tags>
        <tag>ATACseq</tag>
        <tag>ChIPseq</tag>
        <tag>QC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[第3篇：用MACS2软件call peaks]]></title>
    <url>%2F2019%2F08%2F23%2F%E7%AC%AC3%E7%AF%87%EF%BC%9A%E7%94%A8MACS2%E8%BD%AF%E4%BB%B6call%20peaks%2F</url>
    <content type="text"><![CDATA[学习目标： 学会用MACS2 call peaks 理解MACS2 call peaks的结果 Peak CallingPeak calling即利用计算的方法找出ChIP-seq或ATAC-seq中reads富集的基因组区域。 如下图所示，比对结果的文件中reads在正负链不均匀分布，但在结合位点聚集。正负链5‘末端的reads各形成一组合，通过统计学的方法评估这些组合的分布并和对照组比较，确定这些结合位点是否是显著的。 NOTE：ChIP-seq的分析方法可以鉴定两种类型的富集模式：broad domains和narrow peaks。broad domains，如组蛋白修饰在整个基因body区域的分布；narrow peak，如转录因子的结合。narrow peak相对于broad 或者分散的marks更易被检测到。也有一些混合的结合图谱，如PolII包括narrow和broad信号。 MACS2peaks calling 有不同的方法，MACS2是最常用的call peaks工具。 MACS全称Model-based Analysis of ChIP-Seq，最初的设计是用来鉴定转录因子的结合位点，但是它也可以用于其他类型的富集方式测序。MACS通过整合序列标签位置信息和方向信息提高结合位点的空间分辨率。MACS的工作流如下所示： MACS2的使用方法MACS2的用法，call peaks的参数及输出文件的解读可以参考MACS2文档学习。 了解相关参数：输入文件参数： -t:实验组，IP的数据文件 c: 对照组 f：指定输入文件的格式，默认是自动检测输入数据是什么格式，支持bam,sam,bed等 g:有效基因组大小，由于基因组序列的重复性，基因组实际可以mapping的大小小于原始的基因组。这个参数要根据实际物种计算基因组的有效大小。软件里也给出了几个默认的-g 值：hs – 2.7e9表示人类的基因组有效大小(UCSC human hg18 assembly). hs: 2.7e9 mm: 1.87e9 ce: 9e7 dm: 1.2e8 输出文件参数： --outdir:输出结果的存储路径 -n:输出文件名的前缀 -B/--bdg:输出bedgraph格式的文件，输出文件以NAME+’_treat_pileup.bdg’ for treatment data, NAME+’_control_lambda.bdg’ for local lambda values from control显示。 peak calling 参数 -q/--qvalue 和 -p/--pvalueq value默认值是0.05，与pvalue不能同时使用。 --broadpeak有narrow peak和broad peak, 设置时可以call broad peak 的结果文件。 --broad-cutoff和pvalue、以及qvalue相似 --nolambda: 不要考虑在峰值候选区域的局部偏差/λ q值与峰宽有一定的联系。理想情况下，如果放宽阈值，您将简单地获得更多的peaks，但是使用MACS2放松阈值也会导致更宽的peaks。 Shift 模型参数： --nomodel这个参数和extsize、shift是配套使用的，有这个参数才可以设置extsize和shift。 --extsize当设置了nomodel时，MACS会用--extsize这个参数从5’-&gt;3’方向扩展reads修复fragments。比如说你的转录因子结合范围200bp，就设置这个参数是200。 --shift当设置了–nomodel，MACS用这个参数从5’ 端移动剪切，然后用–extsize延伸，如果–shift是负值表示从3’端方向移动。建议ChIP-seq数据集这个值保持默认值为0，对于检测富集剪切位点如DNAsel数据集设置为EXTSIZE的一半。示例： 想找富集剪切位点，如DNAse-seq，所有5’端的序列reads应该从两个方向延伸，如果想设置移动的窗口是200bp，参数设置如下：--nomodel --shift -100 --extsize 200 对nucleosome-seq数据，用核小体大小的一半进行extsize,所以参数设置如下：--nomodel --shift 37 --extsize 73 --call-summitsMACS利用此参数重新分析信号谱，解析每个peak中包含的subpeak。对相似的结合图谱，推荐使用此参数，当使用此参数时，输出的subpeak会有相同的peak边界，不同的绩点和peak summit poisitions. ATAC-Seq call peaks示例ATAC-seq关心的是在哪切断，断点才是peak的中心，所以使用shift模型，–shift -75或-100对人细胞系ATAC-seq 数据call peak的参数设置如下：1macs2 callpeak -t H1hesc.final.bam -n sample --shift -100 --extsize 200 --nomodel -B --SPMR -g hs --outdir Macs2_out 2&gt; sample.macs2.log MACS2输出文件解读 NAME_peaks.xls包含peak信息的tab分割的文件，前几行会显示callpeak时的命令。输出信息包含： 染色体号 peak起始位点 peak结束位点 peak区域长度 peak的峰值位点（summit position） peak 峰值的高度（pileup height at peak summit, -log10(pvalue) for the peak summit） peak的富集倍数（相对于random Poisson distribution with local lambda）Coordinates in XLS is 1-based which is different with BED formatXLS里的坐标和bed格式的坐标还不一样，起始坐标需要减1才与narrowPeak的起始坐标一样。 NAME_peaks.narrowPeak*narrowPeak文件是BED6+4格式，可以上传到UCSC浏览。输出文件每列信息分别包含： 1；染色体号 2：peak起始位点 3：结束位点 4：peak name 5：int(-10*log10qvalue) 6 ：正负链 7：fold change 8：-log10pvalue 9：-log10qvalue 10：relative summit position to peak start（？） NAME_summits.bedBED格式的文件，包含peak的summits位置，第5列是-log10pvalue。如果想找motif，推荐使用此文件。 Remove the beginning track line if you want to analyze it by other tools.??? .bdgbedGraph格式，可以导入UCSC或者转换为bigwig格式。两种bfg文件：treat_pileup, and control_lambda. NAME_peaks.broadPeakBED6+3格式与narrowPeak类似，只是没有第10列。 summits.bed，narrowPeak，bdg, xls四种类型输出文件的比较： xls文件文件包含信息还是比较多的，和narrowPeak唯一不同的是peak的起始位置需要减1才是bed格式的文件，另外还包含fold_enrichment 和narrowPeak的fold change 对应，-log10pvalue,-log10qvalue,peak长度，peak 峰值位置等。 narrowPeak文件和xls文件信息类似 summits.bed文件包含峰的位置信息和-log10pvalue bdg文件bdg文件适合导入UCSC或IGV进行谱图可视化，或者转换为bigwig格式再进行可视化。为什么染色体号后面会出现其他的字符串？？？？ 参考资料：HBC的深度NGS数据分析课程MCAS2文档]]></content>
      <categories>
        <category>组学</category>
        <category>表观组</category>
      </categories>
      <tags>
        <tag>ATACseq</tag>
        <tag>ChIPseq</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[第2篇：原始数据的质控、比对和过滤]]></title>
    <url>%2F2019%2F08%2F23%2F%E7%AC%AC2%E7%AF%87%EF%BC%9A%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%E7%9A%84%E8%B4%A8%E6%8E%A7%E3%80%81%E6%AF%94%E5%AF%B9%E5%92%8C%E8%BF%87%E6%BB%A4%2F</url>
    <content type="text"><![CDATA[这部分内容包括对原始测序数据质控，然后比对过滤，这是所有NGS数据处理的上游分析。 ATAC-Seq与其他方法不同的一点是需要过滤去除线粒体（如果是植物，还需要过滤叶绿体），因为线粒体DNA是裸露的，也可以被Tn5酶识别切割。 另外一点需要注意的是课程中给出的是单端比对的示例代码，如果是双端测序做相应更改即可。 学习目标 用FastQC进行质控检测 用Trimmomatic进行质量过滤 用Bowtie2比对，并理解相关参数含义 测序reads 的质控流程示意图 FASTQC首先对拿到的原始测序数据（fastq或fastq.gz格式）进行质控检测，直接用fastqc软件，再加上multiqc将多个检测结果一起展示。如:12fastqc -o out_dir raw_data/*gzmultiqc *fastqc.zip --ignore *.html TrimmomaticTrimmomatic 可以用于去除接头，过滤低质量数据。相同功能的软件还有很多，如trim_galore、cutadapt等，个人比较喜欢trim_galore可以自动识别接头类型。123456789# 课程中给出的Trimmomatic 的用法（单端测序）$ java -jar /opt/Trimmomatic-0.33/trimmomatic-0.33.jar SE \-threads 2 \-phred33 \H1hesc_Input_Rep1_chr12.fastq \../results/trimmed/H1hesc_Input_Rep1_chr12.qualtrim20.minlen36.fq \LEADING:20 \TRAILING:20 \MINLEN:36 Trimmomatic参数含义：可以参考NGS 数据过滤之 Trimmomatic 详细说明trim_galore使用示例 1trim_galore -q 20 --phred33 --stringency 3 --length 20 -e 0.1 --paired fq1 fq2 --gzip -o input_data_dir 123# 重新用fastqc检测进行过滤后的reads质量fastqc -o out_dir *fq.gzmultiqc *fastqc.zip --ignore *.html 比对Bowtie2是一个快速精确的比对工具，基于Burrows-Wheeler Transform 构建基因组的FM 索引，比对过程所耗内存少。Bowtie2支持局部、双端、缺口比对模式，对大于50bp的reads比对效果更好（小于50bp的reads用Bowtie1）。 创建Bowtie2索引12bowtie2-build &lt;path_to_reference_genome.fa&gt; &lt;prefix_to_name_indexes&gt;# Can find indexes for the entire genome on Orchestra using following path: /groups/shared_databases/igenome/Homo_sapiens/UCSC/hg19/Sequence/Bowtie2Index/ Bowtie2 比对 p: 线程数 q: reads是fastq格式 x: index路径 U: fastq路径 S: 输出Sam格式文件12345## 课程中给出的代码是单端比对bowtie2 -p 2 -q \-x ~/ngs_course/chipseq/reference_data/chr12\-U ~/ngs_course/chipseq/results/trimmed/H1hesc_Input_Rep1_chr12.qualtrim20.minlen36.fq \-S ~/ngs_course/chipseq/results/bowtie2/H1hesc_Input_Rep1_chr12_aln_unsorted.sam NOTE: 如果fastq文件是没有经过trim的，可以用局部比对执行soft-clipping，加上参数--local 过滤reads首先将sam文件转为bam格式，再对bam文件进行排序，接着过滤唯一比对的reads，去除线粒体reads。转化为bam格式使用samtools转换格式123samtools view -h -S -b \-o H1hesc_Input_Rep1_chr12_aln_unsorted.bam \H1hesc_Input_Rep1_chr12_aln_unsorted.sam 对bam文件排序对bam文件按照基因组坐标排序，可以直接使用samtools，也可以使用Sambamba。sambamba快速处理bam和sam文件。 123sambamba sort -t 2 \-o H1hesc_Input_Rep1_chr12_aln_sorted.bam \H1hesc_Input_Rep1_chr12_aln_unsorted.bam 过滤唯一比对的reads 123sambamba view -h -t 2 -f bam \-F "[XS] == null and not unmapped " \H1hesc_Input_Rep1_chr12_aln_sorted.bam &gt; H1hesc_Input_Rep1_chr12_aln.bam 去除PCR重复PCR扩增和一些重复序列（如微卫星、着丝粒）会产生重复，干扰真实的富集信号，所以在call peaks前需要先去除重复，这里先用picard去除PCR重复。picard去除PCR重复时要加上参数REMOVE_DUPLICATES=true,否则只是标记了duplicates，并没有去除。 1java -jar picard-tools-1.119/MarkDuplicates.jar REMOVE_DUPLICATES=true I=H1hesc_Input_Rep1_chr12_aln.bam O=H1hesc_Input_Rep1_chr12_aln.dedup.bam M=H1hesc.duplicates.log 过滤线粒体reads 123samtools index H1hesc_Input_Rep1_chr12_aln.dedup.bamsamtools idxstats H1hesc_Input_Rep1_chr12_aln.dedup.bam &gt; H1hesc_Input_Rep1_chr12_aln.dedup.mitochondrial.statssamtools view -h H1hesc_Input_Rep1_chr12_aln.dedup.bam | grep -v 'chrM' | samtools view -bS -o H1hesc.final.bam 上面给出的仅是示例代码，和参考课程不一样，实际运行需要修改相应文件。此时就得到了唯一比对且已经去除过线粒体的比对文件，可以用于接下来的peaks calling。 参考资料：HBC的深度NGS数据分析课程：https://github.com/hbctraining/In-depth-NGS-Data-Analysis-Course/blob/master/sessionV/lessons/02_QC_and_alignment.md]]></content>
      <categories>
        <category>组学</category>
        <category>表观组</category>
      </categories>
      <tags>
        <tag>ATACseq</tag>
        <tag>QC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[第1篇：ATAC-seq的背景介绍以及与ChIP-Seq的异同]]></title>
    <url>%2F2019%2F08%2F23%2F%E7%AC%AC1%E7%AF%87%EF%BC%9AATAC-seq%E7%9A%84%E8%83%8C%E6%99%AF%E4%BB%8B%E7%BB%8D%E4%BB%A5%E5%8F%8A%E4%B8%8EChIP-Seq%E7%9A%84%E5%BC%82%E5%90%8C%2F</url>
    <content type="text"><![CDATA[ATAC-Seq简介ATAC-seq（Assay for Transposase-Accessible Chromatin with high throughput sequencing） 是2013年由斯坦福大学William J. Greenleaf和Howard Y. Chang实验室开发的用于研究染色质可及性（通常也理解为染色质的开放性）的方法， 原理是通过转座酶Tn5容易结合在开放染色质的特性，然后对Tn5酶捕获到的DNA序列进行测序。 真核生物的核DNA并不是裸露的，而是与组蛋白结合形成染色体的基本结构单位核小体，核小体再经逐步的压缩折叠最终形成染色体高级结构（如人的DNA链完整展开约2m长，经过这样的折叠就变成了纳米级至微米级的染色质结构而可以储存在小小的细胞核）。而DNA的复制转录是需要将DNA的紧密结构打开，从而允许一些调控因子结合（转录因子或其他调控因子）。这部分打开的染色质，就叫开放染色质，打开的染色质允许其他调控因子结合的特性称为染色质的可及性（chromatin accessibility）。因此，认为染色质的可及性与转录调控密切相关。开放染色质的研究方法有ATAC-seq以及传统的DNase-Seq及FAIRE-seq等，ATAC-Seq由于所需细胞量少，实验简单，可以在全基因组范围内检测染色质的开放状态，目前已经成为研究染色质开放性的首选技术方法。 Nat Methods, 2013. doi: 10.1038/nmeth.2688. Epub 2013 Oct. ATAC-Seq与ChIP-Seq的异同ATAC-Seq与ChIP-Seq的不同的是ATAC-Seq是全基因组范围内检测染色质的开放程度，可以得到全基因组范围内的蛋白质可能结合的位点信息，一般用于不知道特定的转录因子，用此方法与其他方法结合筛查感兴趣的特定调控因子；但是ChIP-Seq是明确知道感兴趣的转录因子是什么，根据感兴趣的转录因子设计抗体去做ChIP实验拉DNA，验证感兴趣的转录因子是否与DNA存在相互作用。ATAC-Seq、ChIP-Seq、Dnase-Seq、MNase-Seq、FAIRE-Seq整体的分析思路一致，找到富集区域，对富集区域进行功能分析。 ChIP-Seq是揭示特定转录因子或蛋白复合物的结合区域，实际是研究DNA和蛋白质的相互作用，利用抗体将蛋白质和DNA一起富集，并对富集到的DNA进行测序。 DNase-Seq、ATAC-Seq、FAIRE-Seq都是用来研究开放染色质区域。DNase-Seq是用的DNase I内切酶识别开放染色质区域，而ATAC-seq是用的Tn5转座酶，随后进行富集和扩增；FAIRE-Seq是先进行超声裂解，然后用酚-氯仿富集。 MNase-Seq是用来鉴定核小体区域。 翻译部分下面这一部分是对HBC课程中ChIP-Seq Introduction这一节的介绍，主要包括的ChIP-Seq的实验设计和分析方法总体思路。原文链接：https://github.com/hbctraining/In-depth-NGS-Data-Analysis-Course/blob/master/sessionV/lessons/01_Intro_chipseq_and_setup.md。 ChIP-Seq Introduction学习目标 理解ChIP-Seq的实验设计ChIP-Seq简介ChIP实验（Chromatin immunoprecipitation）即染色质免疫沉淀，根据DNA与蛋白质相互作用的原理，分离富集与感兴趣的蛋白相互作用的DNA。ChIP-Seq即对分离得到的DNA扩增测序，然后通过分析得到DNA的富集区域也称为peaks，同时可以鉴定过表达的序列motif以及进行功能注释分析。 下面这一部分将会介绍ChIP-Seq数据分析的整个流程，从实验设计到产生原始的测序reads，以及到最后的功能富集分析和motif查找。 实验设计和文库构建文库构建包括以下5步骤： 蛋白质与DNA的交联 超声打断DNA链 加附有抗体的磁珠用于免疫沉淀 解交联，纯化DNA DNA片段大小选择和PCR扩增 富集到的DNA片段只有一部分是真实的信号（感兴趣的蛋白结合的DNA区域），这个比例取决于number of active binding sites, the number of starting genomes, and the efficiency of the IP. ChIP-Seq富集序列存在以下特点： 开放染色质区域比紧密区域更易打断； 重复序列会出现似乎被富集的现象 序列在整个基因组上不均匀分布 因此，ChIP-Seq需要有合适的对照组，对照样本需要满足以下其中一个条件： 没有IP（input DAN） 没有抗体 (“mock IP”) 没有特定的抗体 (IgG “mock IP”) 示例数据介绍所用到的示例数据是来自于人类胚胎干细胞系（h1-ESC）中Nanog和Pou5f1（Oct4）两个转录因子的结合图谱。这两个转录因子的功能涉及干细胞的多能性，该研究的目标之一是探究这两个转录因子在转录调控中单独和相互的调控作用。两组重复，每组重复包括3个实验样本信息，共6个样本，数据分析中只用到了12号染色体的信息。Nanog IPPou5f1 IPControl input DNA 分析流程下面这幅图给出了整个分析流程，和每一步需要的数据格式，后面会展开介绍。 分析环境配置这个课程提供了示例数据和分析代码，可以参考这里连接他们的服务器，我没有连接成功，不知道是不是打开方式不对，大家可以尝试下，如果连接成功，这一部分就是配置服务器的环境，准备数据；如果也连接不上可以用自己的数据或者下载公共数据。 参考资料：ATAC-seq：染色质开放性测序技术Clifford A. et al. Nature review, 2014HBC课程V : 01-Introduction to ChIP-Seq]]></content>
      <categories>
        <category>组学</category>
        <category>表观组</category>
      </categories>
      <tags>
        <tag>ATACseq</tag>
      </tags>
  </entry>
</search>
